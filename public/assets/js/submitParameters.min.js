let otherExportParams;

function submitTable(container = "dataTable", params = {}) {
    const mainParameterForm = transformFormtoObject($('#mainParameterForm').serializeArray())
    const finalParams = {... { mainParameterForm }, ...params };
    $(`#exportParams${container}`).val(JSON.stringify(params))
    window[`setParamsTable${container}`](finalParams);
    window[`arrangeColumns${container}`](container, 1);
}

function submitContainerTable(container = "dataTable", params = {}) {
    if (typeof submitPage === 'function') {
        submitPage();
    } else {
        // The function doesn't exist
        submitTable(container, params);
    }
}

function autoLoadTable(container = "dataTable") {
    window[`autoLoadTable${container}`]
}

function submitExport(container, url) {
    const exportTable = transformFormtoObject($(`#exportTable${container}`).serializeArray())
    const mainParameterForm = transformFormtoObject($('#mainParameterForm').serializeArray())
    const formDatatable = transformFormtoObject($(`#findDataIn${container}`).serializeArray());
    const otherParams = otherExportParams ? otherExportParams : {};
    const exportParams = JSON.parse($(`#exportParams${container}`).val());
    const mergedForm = Object.assign(formDatatable, exportTable, { mainParameterForm }, otherParams, exportParams);
    const link = `${configView.url}${url}?${$.param(mergedForm)}`;
    window.open(link, '_blank');
}

function transformFormtoObject(form) {
    const transformedObject = {};

    Object.values(form).forEach(({ name, value }) => {
        if (name.includes('[]')) {
            const transformedName = name.replace('[]', '');
            if (transformedObject[transformedName]) {
                transformedObject[transformedName].push(value);
            } else {
                transformedObject[transformedName] = [value];
            }
        } else {
            transformedObject[name] = value;
        }
    });

    return transformedObject;
}